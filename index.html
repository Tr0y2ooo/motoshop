<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8" />
  <title>è±é€Ÿè»Šæ¥­ ï½œ è»Šè¼›å±•ç¤º</title>

  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>

  <style>
    body { margin: 0; font-family: 'Noto Sans TC', sans-serif; background: #f5f5f5; }

    header, footer {
      background: #000; color: #fff; text-align: center; padding: 20px; font-weight: bold; letter-spacing: 2px;
    }
    header { font-size: 1.5rem; }
    footer { font-size: 0.9rem; margin-top: 30px; }

    #filters {
      display: flex; flex-wrap: wrap; gap: 12px; padding: 15px 20px; background: #111; color: #fff;
    }
    #filters select { padding: 6px 12px; border-radius: 6px; border: none; outline: none; font-size: 0.95rem; }

    #bikeGrid {
      display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 20px; padding: 20px;
    }

    .bike-card {
      background: #fff; border-radius: 12px; overflow: hidden; box-shadow: 0 4px 12px rgba(0,0,0,0.15); transition: 0.2s ease;
    }
    .bike-card:hover { transform: translateY(-4px); }

    .image-slider { position: relative; width: 100%; height: 220px; overflow: hidden; }
    .image-slider img { width: 100%; height: 220px; object-fit: cover; display: none; cursor: zoom-in; }
    .image-slider img.active { display: block; animation: fade 0.5s ease; }
    @keyframes fade { from { opacity: 0; } to { opacity: 1; } }

    .arrow { position: absolute; top: 50%; transform: translateY(-50%); background: rgba(0,0,0,0.4); color: white; padding: 8px 12px; border-radius: 6px; cursor: pointer; user-select: none; font-size: 20px; }
    .arrow.left { left: 10px; }
    .arrow.right { right: 10px; }

    .bike-info { padding: 16px; color: #333; }
    .bike-info h3 { margin: 0 0 10px; }

    .status-badge { padding: 4px 10px; border-radius: 8px; color: #fff; font-weight: bold; font-size: 0.85em; }
    .è²©å”®ä¸­ { background: #2e7d32; }
    .å·²å”®å‡º { background: #c62828; }
    .æš«å”®  { background: #ff9800; }
    .ç¶­ä¿®ä¸­ { background: #1565c0; }

    #popupImg { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); display: none; justify-content: center; align-items: center; z-index: 999; }
    #popupImg img { max-width: 90%; max-height: 90%; }
  </style>
</head>
<body>

<header> 
<img src="./logo.png" alt="Logo" style="height:40px; vertical-align:middle; margin-right:10px;">
è±é€Ÿè»Šæ¥­ ï½œ åœ¨åº«è»Šè¼›
<span style="float:right; font-size:0.9rem;">ğŸ“ 0978-795-922 ï½œ ğŸ“ å°ä¸­å¸‚è±åŸå€ä¸­å±±è·¯300è™Ÿ</span>
</header>

<!-- ç¯©é¸é¸å–® -->
<div id="filters">
  <select id="typeFilter">
    <option value="">æ‰€æœ‰è»Šç¨®</option>
    <option value="é€Ÿå¯é”">é€Ÿå¯é”</option>
    <option value="æ‰“æª”è»Š">æ‰“æª”è»Š</option>
    <option value="å…¶ä»–">å…¶ä»–</option>
  </select>
  <select id="displacementFilter">
    <option value="">æ‰€æœ‰æ’æ°£é‡</option>
    <option value="ç™½ç‰Œ">250ä»¥ä¸‹</option>
    <option value="é»ƒç‰Œ">251~550</option>
    <option value="ç´…ç‰Œ">550ä»¥ä¸Š</option>
  </select>
  <select id="statusFilter">
    <option value="">æ‰€æœ‰ç‹€æ…‹</option>
    <option value="è²©å”®ä¸­">è²©å”®ä¸­</option>
    <option value="å·²å”®å‡º">å·²å”®å‡º</option>
    <option value="æš«å”®">æš«å”®</option>
    <option value="ç¶­ä¿®ä¸­">ç¶­ä¿®ä¸­</option>
  </select>
</div>

<div id="bikeGrid"></div>

<div id="popupImg" onclick="this.style.display='none'">
  <img src="">
</div>

<footer>
ğŸ“ 0978-795-922 ï½œ ğŸ“ å°ä¸­å¸‚è±åŸå€ä¸­å±±è·¯300è™Ÿ<br>
Â© 2025 è±é€Ÿè»Šæ¥­ ï½œ Powered by é­”æ³•å¸«å°å‰
</footer>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyDNeIDnfVZpb_lF_2RPBNDaP91nMC1JeWI",
  authDomain: "bike-c4e9d.firebaseapp.com",
  projectId: "bike-c4e9d",
  storageBucket: "bike-c4e9d.firebasestorage.app",
  messagingSenderId: "239868665129",
  appId: "1:239868665129:web:0f80ce710a268bfde1eb38"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

const bikeGrid = document.getElementById("bikeGrid");
const typeFilter = document.getElementById("typeFilter");
const displacementFilter = document.getElementById("displacementFilter");
const statusFilter = document.getElementById("statusFilter");

function isMobile() { return window.innerWidth <= 768; }

function initSlider(slider, imgs) {
  let index = 0;

  if (!isMobile()) {
    // æ¡Œé¢ç‰ˆå·¦å³æŒ‰éˆ•
    const left = slider.querySelector(".arrow.left");
    const right = slider.querySelector(".arrow.right");
    left && (left.onclick = () => switchImg(-1));
    right && (right.onclick = () => switchImg(1));
    function switchImg(dir) {
      imgs[index].classList.remove("active");
      index = (index + dir + imgs.length) % imgs.length;
      imgs[index].classList.add("active");
    }
  } else {
    // æ‰‹æ©Ÿç‰ˆæ‹–æ›³
    let startX = 0, currentX = 0, isDragging = false;
    slider.addEventListener("touchstart", e => {
      startX = e.touches[0].clientX;
      isDragging = true;
      imgs.forEach(img => img.style.transition = "none");
    });
    slider.addEventListener("touchmove", e => {
      if (!isDragging) return;
      currentX = e.touches[0].clientX - startX;
      imgs[index].style.transform = `translateX(${currentX}px)`;
      if (imgs[index + 1]) imgs[index + 1].style.transform = `translateX(${currentX - slider.offsetWidth}px)`;
      if (imgs[index - 1]) imgs[index - 1].style.transform = `translateX(${currentX + slider.offsetWidth}px)`;
    });
    slider.addEventListener("touchend", e => {
      isDragging = false;
      if (currentX < -100 && index < imgs.length - 1) index++;
      else if (currentX > 100 && index > 0) index--;
      imgs.forEach(img => { img.style.transition="transform 0.3s ease"; img.style.transform="translateX(0)"; img.classList.remove("active"); });
      imgs[index].classList.add("active");
      currentX = 0;
    });
  }
}

async function loadBikes() {
  const list = await db.collection("bikes").orderBy("createdAt","desc").get();
  const bikes = list.docs.map(doc => ({ id: doc.id, ...doc.data() }));
  renderBikes(bikes);
}

function renderBikes(bikes) {
  const typeVal = typeFilter.value;
  const dispVal = displacementFilter.value;
  const statusVal = statusFilter.value;

  const filtered = bikes.filter(b => {
    let dispCheck = true;
    if(dispVal){
      if(dispVal==="ç™½ç‰Œ") dispCheck = b.displacement <= 250;
      else if(dispVal==="é»ƒç‰Œ") dispCheck = b.displacement > 250 && b.displacement <= 550;
      else if(dispVal==="ç´…ç‰Œ") dispCheck = b.displacement > 550;
    }
    return (!typeVal || b.type===typeVal) && dispCheck && (!statusVal || b.status===statusVal);
  });

  bikeGrid.innerHTML = "";
  filtered.forEach(b => {
    const card = document.createElement("div"); card.className="bike-card";

    const slider = document.createElement("div"); slider.className="image-slider";

    (b.imageUrls||[]).forEach((url,i)=>{
      const img = document.createElement("img"); img.src=url;
      if(i===0) img.classList.add("active");
      img.addEventListener("click",()=>{
        const popup = document.getElementById("popupImg");
        popup.style.display="flex";
        popup.querySelector("img").src=url;
      });
      slider.appendChild(img);
    });

    if((b.imageUrls||[]).length>1 && !isMobile()){
      const left=document.createElement("div"); left.className="arrow left"; left.innerHTML="â—€";
      const right=document.createElement("div"); right.className="arrow right"; right.innerHTML="â–¶";
      slider.appendChild(left); slider.appendChild(right);
    }

    const imgs = slider.querySelectorAll("img");
    if(imgs.length>1) initSlider(slider, imgs);

    const info=document.createElement("div"); 
	info.className="bike-info";
    info.innerHTML=`
      <h3>${b.model}</h3>
	<p><strong>å¹´ä»½ï¼š</strong>${b.year}</p>
	<p><strong>é‡Œç¨‹ï¼š</strong>${b.mileage} km</p>
	<p><strong>æ’æ°£é‡ï¼š</strong>${b.displacement} cc</p>
	<p><strong>è»Šæ³ï¼š</strong>${b.condition || '-'}</p>
	<p><strong>æ‰€åœ¨åœ°ï¼š</strong>${b.location || '-'}</p>
	<p><strong>å‚™è¨»ï¼š</strong>${b.note || '-'}</p>
	<p><strong>ç‹€æ…‹ï¼š</strong> <span class="status-badge ${b.status}">${b.status}</span></p>
    `;
    card.appendChild(slider); card.appendChild(info); bikeGrid.appendChild(card);
  });
}

typeFilter.addEventListener("change", loadBikes);
displacementFilter.addEventListener("change", loadBikes);
statusFilter.addEventListener("change", loadBikes);

loadBikes();
</script>

</body>
</html>
